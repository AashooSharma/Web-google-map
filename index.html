<!DOCTYPE html>
<html>
<head>
    <title>üìç Sci-Fi IP Logs Auto Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet & PapaParse -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

    <style>
        body {
            background: #0a0f1c;
            color: #00ffee;
            font-family: 'Orbitron', sans-serif;
            text-align: center;
            padding: 20px;
        }
        #map {
            height: 500px;
            width: 90%;
            margin: 20px auto;
            border: 2px solid #00ffee;
            border-radius: 10px;
            box-shadow: 0 0 20px #00ffee;
        }
    </style>
</head>
<body>

    <h2>üìÅ Sci-Fi Map: All User Logs Auto Loaded</h2>
    <div id="map"></div>

    <script>
        const map = L.map('map').setView([20.5937, 78.9629], 5);

        // Dark Matter theme
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO | OpenStreetMap'
        }).addTo(map);

        const userColors = {};
        const colorPalette = [
            "#00ffee", "#ff44ee", "#33ff77", "#ffcc00", "#ff0066", "#00ffff", "#ffaa44", "#cc66ff", "#88ff88", "#ff8888"
        ];

        const bounds = [];

        function getUserColor(username) {
            if (!userColors[username]) {
                userColors[username] = colorPalette[Object.keys(userColors).length % colorPalette.length];
            }
            return userColors[username];
        }

        fetch("logs.csv")
            .then(response => response.text())
            .then(csvText => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        const data = results.data;

                        data.forEach(row => {
                            const lat = parseFloat(row.lat);
                            const lon = parseFloat(row.lon);
                            const user = row.username || "Unknown";
                            const ip = row.ip || "Unknown";
                            const time = row.time || "N/A";

                            if (!isNaN(lat) && !isNaN(lon)) {
                                const color = getUserColor(user);

                                const marker = L.circleMarker([lat, lon], {
                                    radius: 8,
                                    color: color,
                                    fillColor: color,
                                    fillOpacity: 0.6
                                }).addTo(map);

                                marker.bindPopup(`<b>üë§ ${user}</b><br>üåê ${ip}<br>üïí ${time}`);
                                bounds.push([lat, lon]);
                            }
                        });

                        if (bounds.length) {
                            map.fitBounds(bounds);  // Auto zoom to all points
                        }
                    }
                });
            })
            .catch(error => {
                alert("‚ö†Ô∏è Failed to load logs.csv\n" + error);
            });
    </script>

</body>
</html>
